<script>
  // Initialize Stripe with your publishable key
  const stripe = Stripe('your-publishable-key-here');
  const elements = stripe.elements();

  // Define custom styling for Stripe Elements
  const style = {
    base: {
      fontSize: '16px',
      color: '#32325d',
      '::placeholder': {
        color: '#aab7c4',
      },
    },
    invalid: {
      color: '#fa755a',
      iconColor: '#fa755a',
    },
  };

  // Create and mount the card element with custom styles
  const cardElement = elements.create('card', { style });
  cardElement.mount('#card-element');

  // Handle form submission
  const form = document.getElementById('payment-form');
  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    // Step 1: Create a Payment Intent on the server
    const { clientSecret } = await fetch('/create-payment-intent', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        customerName: document.getElementById('customer-name').value,
        customerEmail: document.getElementById('customer-email').value,
        estimateNumber: document.getElementById('estimate-number').value,
      }),
    }).then(res => res.json());

    // Step 2: Confirm the Payment Intent with Stripe
    const { error, paymentIntent } = await stripe.confirmCardPayment(clientSecret, {
      payment_method: {
        card: cardElement,
        billing_details: {
          name: document.getElementById('customer-name').value,
          email: document.getElementById('customer-email').value,
        },
      },
    });

    if (error) {
      // Handle any errors (e.g., display error message to the user)
      console.error('Payment error:', error.message);
      alert(error.message);
    } else if (paymentIntent && paymentIntent.status === 'succeeded') {
      // Step 3: Redirect to the thank-you page after successful payment
      window.location.href = '/thank-you.html'; // Update the path if needed
    }
  });
</script>
